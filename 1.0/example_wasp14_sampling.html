

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example: WASP 14 Sampling &mdash; Starfish 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Starfish 0.1 documentation" href="index.html"/>
        <link rel="next" title="Example: WASP 14 Multiple Orders" href="example_wasp14_multi.html"/>
        <link rel="prev" title="Example: WASP 14 Data Munging" href="example_wasp14_data.html"/>
 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5472810-5', 'auto');
  ga('send', 'pageview');

</script>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Starfish</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#obtaining-model-spectra">Obtaining model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-spectral-emulator">The Spectral Emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#spectrum-data-formats-and-runtime">Spectrum data formats and runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-mcmc-driver-script">The MCMC driver script</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#memory-usage">Memory usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="grid_tools.html">Grid Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#downloading-model-spectra">Downloading model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#raw-grid-interfaces">Raw Grid Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#hdf5-creators-and-fast-interfaces">HDF5 creators and Fast interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#interpolators">Interpolators</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#instruments">Instruments</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spectrum.html">Spectrum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#log-lambda-spacing">Log lambda spacing</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#data-spectrum">Data Spectrum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="emulator.html">Spectral Emulator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#eigenspectra-decomposition">Eigenspectra decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#optimizing-the-emulator">Optimizing the emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#model-spectrum-reconstruction">Model spectrum reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="MCMC.html">MCMC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MCMC.html#creating-the-parameter-script">Creating the parameter script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#hdf5-scripts">HDF5 Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#plotting-scripts">Plotting Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14.html">Example: WASP 14</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#just-getting-set-up">Just getting set up.</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#generating-the-eigenspectra-and-their-weights">Generating the eigenspectra and their weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_data.html">Example: WASP 14 Data Munging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#set-up-the-calibration-parameters">Set up the calibration parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#spot-check-your-data-and-model-parameters">Spot check your data and model parameters</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Example: WASP 14 Sampling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimize">Optimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-an-mcmc-run">Setting up an MCMC run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-mcmc">Running MCMC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sample-with-the-covariance-kernels">Sample with the covariance kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-local-kernels">Generate local kernels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_multi.html">Example: WASP 14 Multiple Orders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#getting-set-up">Getting set up</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#only-spot-check-the-last-order"># Only spot check the last order</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#mcmc"># MCMC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#problems-generating-model-bad-wavelength-range">Problems generating model: Bad wavelength range</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#nonetype-and-parameters-out-of-range">NoneType and parameters out of range</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#fix-c0-is-incorrectly-disabled"><cite>fix_c0</cite> is incorrectly disabled</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips_and_tricks.html">Tips and Tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#time-how-long-it-takes-your-script-to-run">Time how long it takes your script to run.</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#tuning-the-mcmc-jump-sizes">Tuning the MCMC jump sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#how-many-cpus-do-you-have">How many CPUs do you have.</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Starfish</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Example: WASP 14 Sampling</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/example_wasp14_sampling.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="example-wasp-14-sampling">
<h1>Example: WASP 14 Sampling<a class="headerlink" href="#example-wasp-14-sampling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preamble">
<h2>Preamble<a class="headerlink" href="#preamble" title="Permalink to this headline">¶</a></h2>
<p>In this example we will actually perform MCMC sampling with the WASP14 data and stellar synthetic spectral model.  This example assumes you have already completed the two previous examples.</p>
</div>
<div class="section" id="optimize">
<h2>Optimize<a class="headerlink" href="#optimize" title="Permalink to this headline">¶</a></h2>
<p>The first step is to iteratively run an optimization on the <span class="math">\(\Theta\)</span> and <span class="math">\(\phi_{P}\)</span> parameters.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>star.py --optimize<span class="o">=</span>Theta
keeping grid as is
grid pars are <span class="o">[</span>  6.10000000e+03   4.29000000e+00  -2.60000000e-01<span class="o">]</span>
grid:<span class="o">[</span>  6.10000000e+03   4.29000000e+00  -2.60000000e-01<span class="o">]</span> vz:-4.77 vsini:5.79 logOmega:-12.7 Av:0.0 lnp: 68337.603736
grid pars are <span class="o">[</span>  6.40500000e+03   4.29000000e+00  -2.60000000e-01<span class="o">]</span>
grid:<span class="o">[</span>  6.40500000e+03   4.29000000e+00  -2.60000000e-01<span class="o">]</span> vz:-4.77 vsini:5.79 logOmega:-12.7 Av:0.0 lnp: -inf
grid pars are <span class="o">[</span>  6.10000000e+03   4.50450000e+00  -2.60000000e-01<span class="o">]</span>
grid:<span class="o">[</span>  6.10000000e+03   4.50450000e+00  -2.60000000e-01<span class="o">]</span> vz:-4.77 vsini:5.79 logOmega:-12.7 Av:0.0 lnp: 68279.8923689

<span class="o">[</span>...<span class="o">]</span>

Optimization terminated successfully.
     Current <span class="k">function</span> value: -69616.518919
     Iterations: 1333
     Function evaluations: 2074
<span class="o">[</span>  6.30000000e+03   4.19568653e+00  -3.10099805e-01  -4.75122506e+00
   6.69353314e+00  -1.26949259e+01<span class="o">]</span>
</pre></div>
</div>
<p>The code spits out some information about the optimization, with <span class="math">\(\ln{p}\)</span> <em>increasing</em> for convergence.  This process is computationally intensive.  It saves a file <cite>theta.json</cite> with the best fit parameters.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls -t <span class="p">|</span> head -n 2
log.log
theta.json
</pre></div>
</div>
<p>If you want, you can spot-check the optimization by generating residual plots again.  Otherwise, the next step is to optimize the <span class="math">\(\phi_{P}\)</span>.  This does not take as long.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>star.py --optimize<span class="o">=</span>Cheb
keeping grid as is
grid pars are <span class="o">[</span>  6.30000000e+03   4.19000000e+00  -3.10000000e-01<span class="o">]</span>
<span class="m">21</span> <span class="o">[</span> 0.  0.  0.  0.<span class="o">]</span> 69616.4682918
<span class="m">21</span> <span class="o">[</span> 0.00025  0.       0.       0.     <span class="o">]</span> 69614.5115122
<span class="m">21</span> <span class="o">[</span> 0.       0.00025  0.       0.     <span class="o">]</span> 69607.5534798
<span class="m">21</span> <span class="o">[</span> 0.       0.       0.00025  0.     <span class="o">]</span> 69602.4729821
<span class="m">21</span> <span class="o">[</span> 0.       0.       0.       0.00025<span class="o">]</span> 69621.2714096
<span class="m">21</span> <span class="o">[</span> 0.000125  0.000125 -0.00025   0.000125<span class="o">]</span> 69627.2303859
<span class="m">21</span> <span class="o">[</span> 0.0001875  0.0001875 -0.0005     0.0001875<span class="o">]</span> 69638.1985919
<span class="m">21</span> <span class="o">[</span> 0.00021875 -0.00015625 -0.00025     0.00021875<span class="o">]</span> 69637.4464359
<span class="m">21</span> <span class="o">[</span> -4.68750000e-05   1.56250000e-05  -3.75000000e-04   3.28125000e-04<span class="o">]</span> 69642.6705253
<span class="m">21</span> <span class="o">[</span> -1.95312500e-04   2.34375000e-05  -5.62500000e-04   4.92187500e-04<span class="o">]</span> 69655.4960311
<span class="m">21</span> <span class="o">[</span>  1.05468750e-04   2.73437500e-05  -6.56250000e-04   5.74218750e-04<span class="o">]</span> 69659.6974336

<span class="o">[</span>...<span class="o">]</span>

<span class="m">21</span> <span class="o">[</span>-0.00440223 -0.0182905  -0.0186727  -0.00466996<span class="o">]</span> 70403.8324541
Optimization terminated successfully.
         Current <span class="k">function</span> value: -70403.832469
         Iterations: 123
         Function evaluations: 214
<span class="m">21</span> <span class="o">[</span>-0.00440322 -0.01828718 -0.01867513 -0.00466447<span class="o">]</span>

<span class="nv">$ </span>ls -t <span class="p">|</span> head -n 1
s0_o21phi.json
</pre></div>
</div>
<p>The code currently seems to have a bug: when a single order is optimized as shown above, the <cite>phi.json</cite> is incorrectly updated to flip <cite>fix_c0 = false</cite>.  There should only be 3 polynomial terms in this case, but instead 4 terms are shown.  I am not sure the origin of this problem.  Notably, it goes away when you run the code on multiple spectral orders.</p>
</div>
<div class="section" id="setting-up-an-mcmc-run">
<h2>Setting up an MCMC run<a class="headerlink" href="#setting-up-an-mcmc-run" title="Permalink to this headline">¶</a></h2>
<p>Once you have your <cite>config.yaml</cite> file and <cite>*phi.json</cite> files to a pretty close fit, the next step is to perform MCMC sampling.  But before we do that, we must change directories to the &#8220;run number&#8221;.  The reason is that you probably want to re-run the chains with different starting values to make sure you have converged on a unique solution.  Besides, you might want to experiment by tweaking some other parameter and seeing how your results change (like turning on or off the local or global covariance kernels).  So you have to hand edit the file paths in your <cite>config.yaml</cite> file.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>output/example_wasp14/run01/

<span class="nv">$ </span>cp ../../../s0_o21phi.json .

<span class="nv">$ </span>mkdir plots

<span class="nv">$ </span>cat config.yaml
<span class="c"># YAML configuration script</span>

name: example_wasp14

data:
  grid_name: <span class="s2">&quot;PHOENIX&quot;</span>
<span class="hll">  files: <span class="o">[</span><span class="s2">&quot;../../../data/WASP14/WASP14-2009-06-14.hdf5&quot;</span><span class="o">]</span>
</span>  <span class="c"># data/WASP14/WASP14-2010-03-29.hdf5</span>
  <span class="c"># data/WASP14/WASP14-2010-04-24.hdf5</span>
  instruments : <span class="o">[</span><span class="s2">&quot;TRES&quot;</span><span class="o">]</span>
  orders: <span class="o">[</span>21<span class="o">]</span>
  <span class="c">#orders: [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]</span>

outdir : output/

plotdir : plots/

<span class="c"># The parameters defining your raw spectral library live here.</span>
grid:
  raw_path: <span class="s2">&quot;/Users/gully/GitHub/Starfish/libraries/raw/PHOENIX/&quot;</span>
<span class="hll">  hdf5_path: <span class="s2">&quot;../../../libraries/PHOENIX_TRES_test.hdf5&quot;</span>
</span>  parname: <span class="o">[</span><span class="s2">&quot;temp&quot;</span>, <span class="s2">&quot;logg&quot;</span>, <span class="s2">&quot;Z&quot;</span><span class="o">]</span>
  key_name: <span class="s2">&quot;t{0:.0f}g{1:.1f}z{2:.1f}&quot;</span> <span class="c"># Specifies how the params are stored</span>
  <span class="c"># in the HDF5 file</span>
  parrange: <span class="o">[[</span>6000, 6300<span class="o">]</span>, <span class="o">[</span>4.0, 5.0<span class="o">]</span>, <span class="o">[</span>-1.0, 0.0<span class="o">]]</span>
  wl_range: <span class="o">[</span>5000, 5200<span class="o">]</span>
  buffer: 50. <span class="c"># AA</span>

PCA:
<span class="hll">  path : <span class="s2">&quot;../../../PHOENIX_TRES_PCA.hdf5&quot;</span>
</span>  threshold: 0.999 <span class="c"># Percentage of variance explained by components.</span>
  priors: <span class="o">[[</span>2., 0.0075<span class="o">]</span>, <span class="o">[</span>2., 0.75<span class="o">]</span>, <span class="o">[</span>2., 0.75<span class="o">]]</span> <span class="c"># len(parname) list of 2-element lists. Each 2-element list is [s, r] for the Gamma-function prior on emulator parameters</span>
</pre></div>
</div>
</div>
<div class="section" id="running-mcmc">
<h2>Running MCMC<a class="headerlink" href="#running-mcmc" title="Permalink to this headline">¶</a></h2>
<p>We can now run the MCMC.</p>
<div class="highlight-bash"><div class="highlight"><pre> <span class="nv">$ </span>star.py --sample<span class="o">=</span>ThetaCheb --samples<span class="o">=</span>500
 queried: -inf
 queried: -inf
 grid pars are <span class="o">[</span>  6.30009519e+03   4.18633076e+00  -3.10247073e-01<span class="o">]</span>
 proposed: <span class="o">[</span>  6.30009519e+03   4.18633076e+00  -3.10247073e-01  -4.76870270e+00
    6.69265369e+00  -1.26949101e+01<span class="o">]</span> -inf
 /Users/gully/GitHub/Starfish/Starfish/samplers.py:151: RuntimeWarning: invalid value encountered in double_scalars
   <span class="nv">diff</span> <span class="o">=</span> newlnprob - lnprob0
 queried: -inf
 grid pars are <span class="o">[</span>  6.30480812e+03   4.19077633e+00  -3.09505401e-01<span class="o">]</span>
 proposed: <span class="o">[</span>  6.30480812e+03   4.19077633e+00  -3.09505401e-01  -4.74348160e+00
    6.68660106e+00  -1.26949062e+01<span class="o">]</span> -inf
 queried: -inf
 grid pars are <span class="o">[</span>  6.29854048e+03   4.18474171e+00  -3.09595679e-01<span class="o">]</span>
 proposed: <span class="o">[</span>  6.29854048e+03   4.18474171e+00  -3.09595679e-01  -4.75665050e+00
    6.68735787e+00  -1.26949174e+01<span class="o">]</span> 69888.9780735
 Calling acceptfn
 queried: 69888.9780735
 grid pars are <span class="o">[</span>  6.30990092e+03   4.18330405e+00  -3.09893052e-01<span class="o">]</span>
 proposed: <span class="o">[</span>  6.30990092e+03   4.18330405e+00  -3.09893052e-01  -4.74432530e+00
    6.68470437e+00  -1.26946736e

 <span class="o">[</span>...<span class="o">]</span>

 Final <span class="o">[</span>  6.29511725e+03   4.17353475e+00  -3.07618325e-01  -4.74908727e+00
6.70671886e+00  -1.26955186e+01<span class="o">]</span>
</pre></div>
</div>
<p>The chain of stellar parameters is stored in <cite>mc.hdf5</cite>.  The file <cite>s0_o21phi/mc.hdf5</cite> contains the chain for the calibration parameters.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls
config.yaml    log.log        mc.hdf5        s0_o21         s0_o21phi.json
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chain.py --files mc.hdf5 --chain
mc.hdf5 burning by <span class="m">0</span> and thinning by 1
Using a total of <span class="m">1</span> flatchains

<span class="nv">$ </span>open walkers.png
</pre></div>
</div>
<img alt="_images/walkers.png" src="_images/walkers.png" />
<img alt="_images/residual_500mc.png" src="_images/residual_500mc.png" />
</div>
<div class="section" id="sample-with-the-covariance-kernels">
<h2>Sample with the covariance kernels<a class="headerlink" href="#sample-with-the-covariance-kernels" title="Permalink to this headline">¶</a></h2>
<p>The next step is to sample in all of the parameters at once: <span class="math">\(\Theta, \phi_{P}, \phi_{C}\)</span>.</p>
<div class="highlight-bash"><div class="highlight"><pre> <span class="nv">$ </span><span class="nb">time </span>star.py --sample<span class="o">=</span>ThetaPhi --samples<span class="o">=</span>500

 <span class="o">[</span>...<span class="o">]</span>

 Final <span class="o">[</span>  6.22805414e+03   4.26403473e+00  -3.42007962e-01  -4.85008754e+00
6.12838113e+00  -1.26980990e+01<span class="o">]</span>

 real  6m22.483s
 user  21m41.059s
 sys 1m11.610s
</pre></div>
</div>
<p>It took about 6.3 minutes to run 500 samples on my Macbook pro.</p>
</div>
<div class="section" id="generate-local-kernels">
<h2>Generate local kernels<a class="headerlink" href="#generate-local-kernels" title="Permalink to this headline">¶</a></h2>
<p>Finally, we will generate local kernels.  We generate a <cite>regions.json</cite> file that lists the lince center locations of the spectral line residual outliers.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>regions.py s0_o21spec.json

<span class="nv">$ </span>cat s0_o21regions.json
<span class="o">{</span>
  <span class="s2">&quot;mus&quot;</span>: <span class="o">[</span>
    5060.009630057251,
    5075.100425150731,
    5079.118048762344,
    5083.563995213442,
    5097.430362087737,
    5107.348576873876,
    5126.779372388678,
    5142.73291345833,
    5151.750303626388
  <span class="o">]</span>,
  <span class="s2">&quot;order&quot;</span>: 21,
  <span class="s2">&quot;spectrum_id&quot;</span>: 0
<span class="o">}</span>
</pre></div>
</div>
<p>The next step is to optimize the properties of the line residual regions.  For each <span class="math">\(\mu\)</span> in the regions.json file, we determine the strength and the width:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>regions_optimize.py s0_o21spec.json
Optimization terminated successfully.
         Current <span class="k">function</span> value: -2566.567741
         Iterations: 44
         Function evaluations: 80
<span class="o">[</span>-14.22271954   3.83325534<span class="o">]</span>
Optimization terminated successfully.
         Current <span class="k">function</span> value: -2817.582326
         Iterations: 38
         Function evaluations: 74
<span class="o">[</span>-13.66610645   4.34129446<span class="o">]</span>
Optimization terminated successfully.
         Current <span class="k">function</span> value: -2846.075557
         Iterations: 40
         Function evaluations: 79
<span class="o">[</span>-13.79217763   4.16261911<span class="o">]</span>

<span class="o">[</span>...<span class="o">]</span>

Optimization terminated successfully.
         Current <span class="k">function</span> value: -3217.991389
         Iterations: 51
         Function evaluations: 93
<span class="o">[</span>-14.00434656   1.2655773 <span class="o">]</span>
</pre></div>
</div>
<p>This process updates the <cite>s0_o21phi.json</cite> file by adding a <cite>regions</cite> entry, with <span class="math">\(N\)</span> groups of amplitude, mean, and width.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat s0_o21phi.json
<span class="o">{</span>
  <span class="s2">&quot;cheb&quot;</span>: <span class="o">[</span>
    -0.018,
    -0.0176,
    -0.004
  <span class="o">]</span>,
  <span class="s2">&quot;fix_c0&quot;</span>: <span class="nb">true</span>,
  <span class="s2">&quot;l&quot;</span>: 20.0,
  <span class="s2">&quot;logAmp&quot;</span>: -13.6,
  <span class="s2">&quot;order&quot;</span>: 21,
  <span class="s2">&quot;regions&quot;</span>: <span class="o">[</span>
    <span class="o">[</span>
      -14.222719540490553,
      5060.009630057251,
      3.833255335347469
    <span class="o">]</span>,
    <span class="o">[</span>
      -13.666106448038837,
      5075.100425150731,
      4.341294458239552
    <span class="o">]</span>,
    <span class="o">[</span>
      -13.792177629661296,
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example_wasp14_multi.html" class="btn btn-neutral float-right" title="Example: WASP 14 Multiple Orders">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example_wasp14_data.html" class="btn btn-neutral" title="Example: WASP 14 Data Munging"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-15, Ian Czekala.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>