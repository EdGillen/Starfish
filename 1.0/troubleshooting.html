

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; Starfish 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Starfish 0.1 documentation" href="index.html"/>
        <link rel="next" title="Tips and Tricks" href="tips_and_tricks.html"/>
        <link rel="prev" title="Example: WASP 14 Multiple Orders" href="example_wasp14_multi.html"/>
 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5472810-5', 'auto');
  ga('send', 'pageview');

</script>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Starfish</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#obtaining-model-spectra">Obtaining model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-spectral-emulator">The Spectral Emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#spectrum-data-formats-and-runtime">Spectrum data formats and runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-mcmc-driver-script">The MCMC driver script</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#memory-usage">Memory usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="grid_tools.html">Grid Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#downloading-model-spectra">Downloading model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#raw-grid-interfaces">Raw Grid Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#hdf5-creators-and-fast-interfaces">HDF5 creators and Fast interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#interpolators">Interpolators</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#instruments">Instruments</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_tools.html#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spectrum.html">Spectrum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#log-lambda-spacing">Log lambda spacing</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#data-spectrum">Data Spectrum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="emulator.html">Spectral Emulator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#eigenspectra-decomposition">Eigenspectra decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#optimizing-the-emulator">Optimizing the emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#model-spectrum-reconstruction">Model spectrum reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="MCMC.html">MCMC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MCMC.html#creating-the-parameter-script">Creating the parameter script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#hdf5-scripts">HDF5 Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#plotting-scripts">Plotting Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14.html">Example: WASP 14</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#just-getting-set-up">Just getting set up.</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#generating-the-eigenspectra-and-their-weights">Generating the eigenspectra and their weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_data.html">Example: WASP 14 Data Munging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#set-up-the-calibration-parameters">Set up the calibration parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#spot-check-your-data-and-model-parameters">Spot check your data and model parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_sampling.html">Example: WASP 14 Sampling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#optimize">Optimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#setting-up-an-mcmc-run">Setting up an MCMC run</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#running-mcmc">Running MCMC</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#sample-with-the-covariance-kernels">Sample with the covariance kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#generate-local-kernels">Generate local kernels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_multi.html">Example: WASP 14 Multiple Orders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#getting-set-up">Getting set up</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#only-spot-check-the-last-order"># Only spot check the last order</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#mcmc"># MCMC</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#problems-generating-model-bad-wavelength-range">Problems generating model: Bad wavelength range</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nonetype-and-parameters-out-of-range">NoneType and parameters out of range</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fix-c0-is-incorrectly-disabled"><cite>fix_c0</cite> is incorrectly disabled</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips_and_tricks.html">Tips and Tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#time-how-long-it-takes-your-script-to-run">Time how long it takes your script to run.</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#tuning-the-mcmc-jump-sizes">Tuning the MCMC jump sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#how-many-cpus-do-you-have">How many CPUs do you have.</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Starfish</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Troubleshooting</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/troubleshooting.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>Here we will cover some possible scenarios that could cause you to get tripped up.</p>
<div class="section" id="problems-generating-model-bad-wavelength-range">
<h2>Problems generating model: Bad wavelength range<a class="headerlink" href="#problems-generating-model-bad-wavelength-range" title="Permalink to this headline">¶</a></h2>
<p>If you use the default <cite>config.yaml</cite> file that comes with Starfish, you might encounter a problem like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>star.py --generate

<span class="o">[</span>...<span class="o">]</span>
AssertionError: determine_chunk_log: wl_min 5084.98 and wl_max
   5285.93 are not within the bounds of the grid 4950.00 to 5250.00.
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
</div>
<p>The origin of this problem should be evident from the error message- your wavelength bounds in your model and data do not match.  This makes sense: you simply told the code the wavelength range in the config.yaml file.  The code then fetched the instrumental resolution from the instrument properties.  When you go to compare the data that is outside that range, the code will fail.  A common problem is being &#8220;off-by-one&#8221; in the order number(s): did you zero- or one- index the order numbers?  Inspect the order of interest with <cite>HDFView.app</cite> to make sure you have the right boundaries, and consider increasing the wavelength padding.</p>
</div>
<div class="section" id="nonetype-and-parameters-out-of-range">
<h2>NoneType and parameters out of range<a class="headerlink" href="#nonetype-and-parameters-out-of-range" title="Permalink to this headline">¶</a></h2>
<p>If you use the default <cite>config.yaml</cite> file that comes with Starfish, you might encounter a problem like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>star.py --generate
keeping grid as is
grid pars are <span class="o">[</span>  5.99900000e+03   4.22000000e+00  -2.60000000e-01<span class="o">]</span>
Process Process-1:
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/anaconda/lib/python3.4/multiprocessing/process.py&quot;</span>, line 254, in _bootstrap
    self.run<span class="o">()</span>
  File <span class="s2">&quot;/anaconda/lib/python3.4/multiprocessing/process.py&quot;</span>, line 93, in run
    self._target<span class="o">(</span>*self._args, **self._kwargs<span class="o">)</span>
  File <span class="s2">&quot;/Users/gully/GitHub/Starfish/Starfish/parallel.py&quot;</span>, line 533, in brain
    <span class="nv">alive</span> <span class="o">=</span> self.interpret<span class="o">()</span>
  File <span class="s2">&quot;/Users/gully/GitHub/Starfish/Starfish/parallel.py&quot;</span>, line 551, in interpret
    <span class="nv">response</span> <span class="o">=</span> func<span class="o">(</span>arg<span class="o">)</span>
  File <span class="s2">&quot;/Users/gully/GitHub/Starfish/Starfish/parallel.py&quot;</span>, line 585, in save
    <span class="nv">model</span> <span class="o">=</span> self.chebyshevSpectrum.k * self.flux_mean + X.dot<span class="o">(</span>self.mus<span class="o">)</span>
TypeError: unsupported operand <span class="nb">type</span><span class="o">(</span>s<span class="o">)</span> <span class="k">for</span> *: <span class="s1">&#39;float&#39;</span> and <span class="s1">&#39;NoneType&#39;</span>
</pre></div>
</div>
<p>This cryptic error message had me confused for quite a while.  It traces back to the fact that <cite>self.mus</cite> is a <cite>NoneType</cite>, which led me down a rabbit hole to figure out why.  It turns out the solution to my particular problem was quite simple.  To understand, inspect the config.yaml file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># YAML configuration script</span>

<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">example_wasp14</span>

<span class="l-Scalar-Plain">data</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">grid_name</span><span class="p-Indicator">:</span> <span class="s">&quot;PHOENIX&quot;</span>
  <span class="l-Scalar-Plain">files</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;data/WASP14/WASP14-2009-06-14.hdf5&quot;</span><span class="p-Indicator">]</span>
  <span class="c1"># data/WASP14/WASP14-2010-03-29.hdf5</span>
  <span class="c1"># data/WASP14/WASP14-2010-04-24.hdf5</span>
  <span class="l-Scalar-Plain">instruments</span> <span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;TRES&quot;</span><span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">orders</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">21</span><span class="p-Indicator">]</span>
  <span class="c1">#orders: [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]</span>

<span class="l-Scalar-Plain">outdir</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output/</span>

<span class="l-Scalar-Plain">plotdir</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">plots/</span>

<span class="c1"># The parameters defining your raw spectral library live here.</span>
<span class="l-Scalar-Plain">grid</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">raw_path</span><span class="p-Indicator">:</span> <span class="s">&quot;/Users/gully/GitHub/Starfish/libraries/raw/PHOENIX/&quot;</span>
  <span class="l-Scalar-Plain">hdf5_path</span><span class="p-Indicator">:</span> <span class="s">&quot;libraries/PHOENIX_TRES_test.hdf5&quot;</span>
  <span class="l-Scalar-Plain">parname</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&quot;temp&quot;</span><span class="p-Indicator">,</span> <span class="s">&quot;logg&quot;</span><span class="p-Indicator">,</span> <span class="s">&quot;Z&quot;</span><span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">key_name</span><span class="p-Indicator">:</span> <span class="s">&quot;t{0:.0f}g{1:.1f}z{2:.1f}&quot;</span> <span class="c1"># Specifies how the params are stored</span>
  <span class="c1"># in the HDF5 file</span>
<span class="hll">  <span class="l-Scalar-Plain">parrange</span><span class="p-Indicator">:</span> <span class="p-Indicator">[[</span><span class="nv">6000</span><span class="p-Indicator">,</span> <span class="nv">6300</span><span class="p-Indicator">],</span> <span class="p-Indicator">[</span><span class="nv">4.0</span><span class="p-Indicator">,</span> <span class="nv">5.0</span><span class="p-Indicator">],</span> <span class="p-Indicator">[</span><span class="nv">-1.0</span><span class="p-Indicator">,</span> <span class="nv">0.0</span><span class="p-Indicator">]]</span>
</span>  <span class="l-Scalar-Plain">wl_range</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">5000</span><span class="p-Indicator">,</span> <span class="nv">5200</span><span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">buffer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">50.</span> <span class="c1"># AA</span>

<span class="l-Scalar-Plain">PCA</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">path</span> <span class="p-Indicator">:</span> <span class="s">&quot;PHOENIX_TRES_PCA.hdf5&quot;</span>
  <span class="l-Scalar-Plain">threshold</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.999</span> <span class="c1"># Percentage of variance explained by components.</span>
  <span class="l-Scalar-Plain">priors</span><span class="p-Indicator">:</span> <span class="p-Indicator">[[</span><span class="nv">2.</span><span class="p-Indicator">,</span> <span class="nv">0.0075</span><span class="p-Indicator">],</span> <span class="p-Indicator">[</span><span class="nv">2.</span><span class="p-Indicator">,</span> <span class="nv">0.75</span><span class="p-Indicator">],</span> <span class="p-Indicator">[</span><span class="nv">2.</span><span class="p-Indicator">,</span> <span class="nv">0.75</span><span class="p-Indicator">]]</span> <span class="c1"># len(parname) list of 2-element lists. Each 2-element list is [s, r] for the Gamma-function prior on emulator parameters</span>

<span class="c1">#Longer strings can be written like this. This will be loaded under the &quot;Comments&quot; variable.</span>
<span class="l-Scalar-Plain">Comments</span><span class="p-Indicator">:</span> <span class="p-Indicator">&gt;</span>
  <span class="no">WASP14 spectrum using emulator.</span>

<span class="c1"># The parameters shared between all orders</span>
<span class="l-Scalar-Plain">Theta</span> <span class="p-Indicator">:</span>
<span class="hll">    <span class="l-Scalar-Plain">grid</span> <span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">5999.</span><span class="p-Indicator">,</span> <span class="nv">4.22</span><span class="p-Indicator">,</span> <span class="nv">-0.26</span><span class="p-Indicator">]</span>
</span>    <span class="l-Scalar-Plain">vz</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-4.77</span>
    <span class="l-Scalar-Plain">vsini</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5.79</span>
    <span class="l-Scalar-Plain">logOmega</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-12.80</span>
    <span class="l-Scalar-Plain">Av</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.0</span>
</pre></div>
</div>
<p>In this case, my guess for the effective temperature value of 5999 K was less than the 6000 K lower boundary of the grid.  If your <strong>Theta:</strong> parameters are outside of the bounds of your <strong>parrange</strong> ranges, it causes the error message above, but with no indication what is wrong.  We should probably add some sort of checking for this as soon as the <cite>config.yaml</cite> file is read-in, but hopefully users will avoid making the same mistake I did!</p>
</div>
<div class="section" id="fix-c0-is-incorrectly-disabled">
<h2><cite>fix_c0</cite> is incorrectly disabled<a class="headerlink" href="#fix-c0-is-incorrectly-disabled" title="Permalink to this headline">¶</a></h2>
<p><cite>fix_c0</cite> is incorrectly disabled when star.py &#8211;optimize=Cheb is run on a single order.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tips_and_tricks.html" class="btn btn-neutral float-right" title="Tips and Tricks">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example_wasp14_multi.html" class="btn btn-neutral" title="Example: WASP 14 Multiple Orders"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-15, Ian Czekala.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>